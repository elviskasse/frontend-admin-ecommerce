class Ecommerce{constructor(){this.api_key="API_KEY=adsffsdfds6b-6727-46f4-8bee-2c6ce6293e41",this.api="http://localhost/ecommerce/backend/api/",this.actions=["orders","users","category","products"],this.data=[],this.initRouter(),this.initDataApp()}initRouter(){this.actions.forEach(a=>{document.getElementById(a).addEventListener("click",()=>{fetch("templates/"+a+".html").then(a=>{if(a.ok)return a.text();console.log("Erreur de chargement du tempate")}).then(t=>{document.getElementsByClassName("container-fluid")[0].innerHTML=t,"products"==a?(this.loadProducts(),document.querySelectorAll(".category").forEach((a,t)=>{var e="";this.getData("category").forEach((a,t)=>{e+="<option value='"+a.idCategory+"'>"+a.name+"</option>"}),a.innerHTML+=e})):"category"==a?this.loadCategory():"users"==a?this.loadUsers():"orders"==a&&this.loadOrders()})})})}initDataApp(){this.actions.forEach(a=>{const t=this.api+a+"?"+this.api_key;fetch(t).then(a=>{if(a.ok)return a.json();console.log("Erreur de chargement des données")}).then(t=>{200==t.status&&this.data.push({name:a,data:t.result})})})}getData(a){return this.data.find(t=>t.name==a).data}getOptions(){var a="";return this.getData("category").forEach((t,e)=>{a+="<option value='"+t.idCategory+"'>"+t.name+"</option>"}),a}loadProducts(){var a=this.getData("category");$("#dataTable").DataTable({data:this.getData("products"),columns:[{data:"idProduct"},{data:"name"},{data:"description"},{data:"price",render:function(a,t,e){return"€"+a}},{data:"stock"},{data:"createdAt"},{data:"idProduct",render:function(t,e,n){var d="";return a.forEach(a=>{a.idCategory==n.Category?d+="<option value='"+a.idCategory+"' selected>"+a.name+"</option>":d+="<option value='"+a.idCategory+"'>"+a.name+"</option>"}),`<button type="button" data-toggle="modal" data-target="#updateProduct-${t}" class="btn btn-success">UPDATE</button>\n                            <button type="button" data-toggle="modal" data-target="#deleteProduct-${t}" class="btn btn-danger">DELETE</button>\n\n                    \x3c!-- Modal UPDATE PRODUCT--\x3e\n                    <div class="modal fade" id="updateProduct-${t}" tabindex="-1" aria-labelledby="updateProductModalLabel" aria-hidden="true">\n                        <div class="modal-dialog">\n                            <div class="modal-content">\n                                <div class="modal-header">\n                                    <h2 class="modal-title" id="exampleModalLabel">Update Product</h2>\n                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                                        <span aria-hidden="true">&times;</span>\n                                    </button>\n                                </div>\n                                <div class="modal-body">\n                                    <form action="" id="formUpdateProduct-${t}">\n                                        <div class="form-row">\n                                            <div class="col">\n                                                <label for="name">Name : </label>\n                                                <input  name="name" type="text" value="${n.name}" class="form-control" required>\n\n                                                <span class="">This field is required</span>\n\n                                            </div>\n                                        </div>\n                                        <div class="form-row">\n                                            <div class="col">\n                                                <label for="description">Description : </label>\n                                                <textarea  name="description" cols="30" rows="10" class="form-control" required>${n.description}</textarea>\n                                            </div>\n                                        </div>\n                                        <div class="form-row">\n                                            <div class="col">\n                                                <label for="price">Price : </label>\n                                                <input  name="price" value="${n.price}" type="number" class="form-control" required>\n                                            </div>\n                                            <div class="col">\n                                                <label for="stock">Stock : </label>\n                                                <input  name="stock" value="${n.stock}" type="number" class="form-control" required>\n                                            </div>\n                                            <div class="col">\n                                                <label for="category">Category : </label>\n                                                <select  name="category" class="form-control" required>\n                                                  ${d}\n                                                </select>\n                                            </div>\n                                            <div class="col">\n                                                <label for="image" >Image : </label>\n                                                <input  name="image" type="file" class="form-control"  accept="image/*">\n                                            </div>\n                                        </div>\n                                    </form>\n                                </div>\n                                <div class="modal-footer">\n                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>\n                                    <button type="button" onclick="updateProduct(${t}, '${n.image}')" data-dismiss="modal" class="btn btn-primary">Update Product</button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- Modal DELETE PRODUCT--\x3e\n                    <div class="modal fade" id="deleteProduct-${t}" tabindex="-1" aria-labelledby="deleteProductModalLabel" aria-hidden="true">\n                        <div class="modal-dialog">\n                            <div class="modal-content">\n                                <div class="modal-header">\n                                    <h2 class="modal-title" id="deleteModalLabel">Confirmation message</h2>\n                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n                                        <span aria-hidden="true">&times;</span>\n                                    </button>\n                                </div>\n                                <div class="modal-body">\n                                    <p>Are you sure you want to delete this product? We remind you that this action is irreversible!</p>\n                                </div>\n                                <div class="modal-footer">\n                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>\n                                    <button type="button" onclick="deleteProduct(${t})" data-dismiss="modal" class="btn btn-danger">Delete Product</button>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n\n                    `}}]})}loadCategory(){$("#dataTable").DataTable({data:this.getData("category"),columns:[{data:"idCategory"},{data:"name"}]})}loadUsers(){$("#dataTable").DataTable({data:this.getData("users"),columns:[{data:"idUser"},{data:"email"},{data:"firstname"},{data:"lastname"}]})}loadOrders(){$("#dataTable").DataTable({data:this.getData("orders"),columns:[{data:"idOrder"},{data:"idUser"},{data:"idProduct"},{data:"quantity"},{data:"price"},{data:"createdAd"}]})}}export{Ecommerce};
