API_KEY="adsffsdfds6b-6727-46f4-8bee-2c6ce6293e41",API="http://localhost/ecommerce/backend/api/",API_UPLOAD_IMAGE="http://localhost/ecommerce/backend/api/uploadImage.php",addProduct=(()=>{let e=document.getElementById("formProduct"),t=new FormData(e),o=t.get("image");t.set("image",t.get("image").name),t.append("API_KEY",API_KEY);const a=API+"products";fetch(a,{method:"POST",body:t}).then(e=>{if(e.ok)return e.json()}).then(e=>{if(200==e.status){console.log(e),uploadImage(o);var a=$("#dataTable").DataTable(),r=a.rows().data().length;let s={idProduct:a.row(r-1).data().idProduct+1,name:t.get("name"),description:t.get("description"),price:t.get("price"),stock:t.get("stock"),Category:t.get("category"),image:t.get("image"),createdAt:(new Date).toISOString().slice(0,19).replace("T"," ")};a.row.add(s).draw(),document.getElementById("formProduct").reset(),document.getElementsByClassName("close")[0].click()}else console.log(e.message)})}),updateProduct=((e,t)=>{let o=document.getElementById("formUpdateProduct-"+e),a=new FormData(o);a.append("API_KEY",API_KEY),a.append("idProduct",e);let r=a.get("image");""!==r.name?a.set("image",r.name):a.set("image",t);let s={};for(var d of a.entries())s[d[0]]=d[1];const c=API+"products?"+constructURLParams(s);fetch(c,{method:"PUT"}).then(e=>{if(e.ok)return e.json();console.log("Erreur déclenchée lors de l'exécution de la requête de mise à jour du produit")}).then(o=>{if(200==o.status){""!==r.name&&(uploadImage(r),deleteImage(t));var a=$("#dataTable").DataTable().rows().data(),d=a.filter(t=>t.idProduct==e)[0],c=a.indexOf(d);d.name=s.name,d.description=s.description,d.price=s.price,d.stock=s.stock,d.Category=s.category,d.image=s.image,$("#dataTable").dataTable().fnUpdate(d,c,void 0,!1)}else console.log(o.message)})}),deleteProduct=(e=>{const t=API+"products?id="+e+"&API_KEY="+API_KEY;fetch(t,{method:"DELETE"}).then(e=>{if(e.ok)return e.json();console.log("Erreur déclenchée lors de l'exécution de la requête de suppression du produit")}).then(t=>{if(200==t.status){var o=$("#dataTable").DataTable().rows().data(),a=o.filter(t=>t.idProduct==e)[0],r=o.indexOf(a);$("#dataTable").dataTable().fnDeleteRow(r),deleteImage(a.image),console.log(t.result)}else console.log(t.message)})}),constructURLParams=(e=>{result="";for(const t in e)result+=`${t}=${e[t]}&`;return result}),uploadImage=(e=>{let t=new FormData;t.append("image",e),t.append("API_KEY",API_KEY),fetch(API_UPLOAD_IMAGE,{method:"POST",body:t}).then(e=>{if(e.ok)return e.json()}).then(e=>{200==e.status?console.log("Image stockée sur le serveur avec succès"):console.log(e.message)})}),deleteImage=(e=>{const t=API+"image?name="+e+"&API_KEY="+API_KEY;fetch(t,{method:"DELETE"}).then(e=>{if(e.ok)return e.json();console.log("Erreur déclenchée lors de l'exécution de la requête ")}).then(e=>{200==e.status?console.log(e.result):console.log(e.message)})});
